<!DOCTYPE html>
<html lang="en-GB" dir="ltr" class="client-nojs">

<!-- Mirrored from wiki.hellground.net/index.php/Tutorial:Fix_8076 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 12 Apr 2016 10:50:54 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<title>Tutorial:Fix 8076 - HellGroundCore MMORPG framework educational and hobby project</title>
<meta charset="UTF-8" />
<meta name="generator" content="MediaWiki 1.21.4" />
<link rel="shortcut icon" href="http://wiki.hellground.net/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.hellground.net/opensearch_desc.php" title="HellGroundCore MMORPG framework educational and hobby project (en-gb)" />
<link rel="EditURI" type="application/rsd+xml" href="http://wiki.hellground.net/api.php?action=rsd" />
<link rel="alternate" type="application/atom+xml" title="HellGroundCore MMORPG framework educational and hobby project Atom feed" href="http://wiki.hellground.net/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="http://wiki.hellground.net/load.php?debug=false&amp;lang=en-gb&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cskins.vector&amp;only=styles&amp;skin=vector&amp;*" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: admin_wikia:resourceloader:filter:minify-css:7:584a0492c58c82e3a4daddd5656471fb */</style>

<script src="http://wiki.hellground.net/load.php?debug=false&amp;lang=en-gb&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Tutorial:Fix_8076","wgTitle":"Tutorial:Fix 8076","wgCurRevisionId":1166,"wgArticleId":303,"wgIsArticle":true,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Fixing tutorials","Fixing tutorials (easy)"],"wgBreakFrames":false,"wgPageContentLanguage":"en-gb","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Tutorial:Fix_8076","wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function(){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"externaldiff":0,"externaleditor":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"quickbar":5,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"showjumplinks":1,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"vector","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":0,"watchdefault":0,"watchdeletion":0,"watchlistdays":3,
"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"variant":"en-gb","language":"en-gb","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false});;},{},{});mw.loader.implement("user.tokens",function(){mw.user.tokens.set({"editToken":"+\\","patrolToken":false,"watchToken":false});;},{},{});
/* cache key: admin_wikia:resourceloader:filter:minify-js:7:811a3adb8f714f1f28210df16d324ee9 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/vector/csshover.min.htc")}</style><![endif]--></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Tutorial_Fix_8076 skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<!-- content -->
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="mw-js-message" style="display:none;"></div>
						<!-- firstHeading -->
			<h1 id="firstHeading" class="firstHeading" lang="en-gb"><span dir="auto">Tutorial:Fix 8076</span></h1>
			<!-- /firstHeading -->
			<!-- bodyContent -->
			<div id="bodyContent">
								<!-- tagline -->
				<div id="siteSub">From HellGroundCore MMORPG framework educational and hobby project</div>
				<!-- /tagline -->
								<!-- subtitle -->
				<div id="contentSub"></div>
				<!-- /subtitle -->
																<!-- jumpto -->
				<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-navigation">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<!-- /jumpto -->
								<!-- bodycontent -->
				<div id="mw-content-text" lang="en-GB" dir="ltr" class="mw-content-ltr"><div class="toc" style="float: right; margin-left: 1em; margin-bottom: 1em; padding: 0">
<table style="width: 250px; margin: 0; border: 0 none">

<tr>
<td colspan="2" style="color: white; text-align: center; background-color: #DB9100;">
<p><span style="font-size: 120%"><b>Fix tutorial</b></span><br />
Wildlord Antelarion
</p>
</td></tr>
<tr>
<td width="60">Revision: </td>
<td> 8076
</td></tr>
<tr>
<td> Issue: </td>
<td> #000175
</td></tr>
<tr>
<td> Difficulty: </td>
<td> <a href="Category_Fixing_tutorials_(easy).html" title="Category:Fixing tutorials (easy)">easy</a>
</td></tr>
<tr>
<td> Category: </td>
<td> Scripts
</td></tr></table></div>
<p><b>Problem:</b> <a rel="nofollow" class="external text" href="http://db.hellground.net/?npc=22127">Wildlord Antelarion</a> is supposed to give player replacement <a rel="nofollow" class="external text" href="http://db.hellground.net/?item=31763">Druid Signal</a> when player loses orginal one. This npc also offers replacement for other item (<a rel="nofollow" class="external text" href="http://db.hellground.net/?item=31366">Felsworn Gas Mask</a>) for other quest, problem is: no matter if player chooses option to "Restore Druid Signal" or "Restore Felsworn Gas Mask" he receives Felsworn Gas Mask.
</p>
<h2> <span class="mw-headline" id="Step-by-step_solving">Step-by-step solving</span></h2>
<p><b>Step 0:</b> Before starting we at most need to check if report is true (it was).
</p><p><br />
<b>Step 1:</b> Where to begin; seems that npc is not doing what he should, so first guess is problem with npc script. Those are sorted by zone, we find Antelarion in <a rel="nofollow" class="external text" href="https://bitbucket.org/_hellground/hellground-core/src/default/src/scripts/scripts/Outland/blades_edge_mountains/blades_edge_mountains.cpp"><i>blades_edge_mountains.cpp</i></a>. There are two functions which are needed for "talking" npcs, one which prepares "hello gossip"-things npc say and menu options displayed when first spoken to; and one which is called when player chooses an option. In our case that functions are <code>GossipHello_npc_wildlord_antelarion(...)</code> and <code>GossipSelect_npc_wildlord_antelarion(...)</code>.
</p><p><br />
<b>Step 2:</b> Hello gossip; this function seems fine, it makes npc display some words of greeting, aviable quests, and if needed (if player has certain quests started) two options for restoring item. As we noticed displaying options works well, problem shall be in the other function.
</p><p><br />
<b>Step 3:</b> Gossip select; function begins like:
</p>
<pre>
bool GossipSelect_npc_wildlord_antelarion(Player* player, Creature* creature, uint32 sender, uint32 action){

uint32 entry = 0;
if (action == GOSSIP_SENDER_INFO)
    entry = 31366;
else if (action == GOSSIP_SENDER_INFO +1)
    entry = 31763;
</pre>
<p>So depending on choosen action we set <code>entry</code> value to entry of item we need, this seems well, item ids are correct.
</p>
<pre>
if (entry&#160;!= 0)
{
    ItemPosCountVec dest;
    uint8 msg = player-&gt;CanStoreNewItem(NULL_BAG, NULL_SLOT, dest, 31366, 1);
    if (msg == EQUIP_ERR_OK)
    {
        Item* item = player-&gt;StoreNewItem(dest, 31366, true);
        player-&gt;SendNewItem(item,1,true,false,true);
    }
    player-&gt;CLOSE_GOSSIP_MENU();
}
return true;
</pre>
<p>entry is not 0 means we had chosen one of "restore" options, so we get inside this if-clause.
</p><p>then we check if and where player can store an item with id 31366. If he can then... wait a minute...
</p><p><br />
<b>Step 4:</b> Yep, our <code>entry</code> is completely unused, someone made a mistake when adding new option to this script. Script always checks for and gives item 31366 which is Felsworn Gas Mask. So solution is simple, replace <code>31366</code> with <code>entry</code> in <code>CanStoreNewItem(...)</code> and <code>StoreNewItem(...)</code>
</p>
<pre>
uint8 msg = player-&gt;CanStoreNewItem(NULL_BAG, NULL_SLOT, dest, entry, 1);
if (msg == EQUIP_ERR_OK)
{
    Item* item = player-&gt;StoreNewItem(dest, entry, true);
    player-&gt;SendNewItem(item,1,true,false,true);
}
</pre>
<h2> <span class="mw-headline" id="Summary">Summary</span></h2>
<p>Lesson for today: Everybody makes mistakes. If you screw something up don't worry, making mistakes is also a way of learning, someone will fix it sooner or soon™.
</p>
<!-- 
NewPP limit report
Preprocessor visited node count: 89/1000000
Preprocessor generated node count: 330/1000000
Post‐expand include size: 868/2097152 bytes
Template argument size: 212/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key admin_wikia:pcache:idhash:303-0!*!0!!*!*!* and timestamp 20160412104830 -->
</div>				<!-- /bodycontent -->
								<!-- printfooter -->
				<div class="printfooter">
				Retrieved from ‘<a href="http://wiki.hellground.net/index.php?title=Tutorial:Fix_8076&amp;oldid=1166">http://wiki.hellground.net/index.php?title=Tutorial:Fix_8076&amp;oldid=1166</a>’				</div>
				<!-- /printfooter -->
												<!-- catlinks -->
				<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="Special_Categories.html" title="Special:Categories">Categories</a>: <ul><li><a href="Category_Fixing_tutorials.html" title="Category:Fixing tutorials">Fixing tutorials</a></li><li><a href="Category_Fixing_tutorials_(easy).html" title="Category:Fixing tutorials (easy)">Fixing tutorials (easy)</a></li></ul></div></div>				<!-- /catlinks -->
												<div class="visualClear"></div>
				<!-- debughtml -->
								<!-- /debughtml -->
			</div>
			<!-- /bodyContent -->
		</div>
		<!-- /content -->
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<!-- header -->
			<div id="mw-head">
				
<!-- 0 -->
<div id="p-personal" role="navigation" class="">
	<h3>Personal tools</h3>
	<ul>
<li id="pt-login"><a href="http://wiki.hellground.net/index.php?title=Special:UserLogin&amp;returnto=Tutorial%3AFix+8076" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>	</ul>
</div>

<!-- /0 -->
				<div id="left-navigation">
					
<!-- 0 -->
<div id="p-namespaces" role="navigation" class="vectorTabs">
	<h3>Namespaces</h3>
	<ul>
					<li  id="ca-nstab-main" class="selected"><span><a href="Tutorial_Fix_8076.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
					<li  id="ca-talk" class="new"><span><a href="http://wiki.hellground.net/index.php?title=Talk:Tutorial:Fix_8076&amp;action=edit&amp;redlink=1"  title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>
			</ul>
</div>

<!-- /0 -->

<!-- 1 -->
<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet">
	<h3 id="mw-vector-current-variant">
		</h3>
	<h3><span>Variants</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>

<!-- /1 -->
				</div>
				<div id="right-navigation">
					
<!-- 0 -->
<div id="p-views" role="navigation" class="vectorTabs">
	<h3>Views</h3>
	<ul>
					<li id="ca-view" class="selected"><span><a href="Tutorial_Fix_8076.html" >Read</a></span></li>
					<li id="ca-viewsource"><span><a href="http://wiki.hellground.net/index.php?title=Tutorial:Fix_8076&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
					<li id="ca-history" class="collapsible"><span><a href="http://wiki.hellground.net/index.php?title=Tutorial:Fix_8076&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
			</ul>
</div>

<!-- /0 -->

<!-- 1 -->
<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet">
	<h3><span>Actions</span><a href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>

<!-- /1 -->

<!-- 2 -->


<!-- /2 -->
				</div>
			</div>
			<!-- /header -->
			<!-- panel -->
			<div id="mw-panel">
				<!-- logo -->
					<div id="p-logo" role="banner"><a style="background-image: url(../skins/common/images/wiki.png);" href="Main_Page.html"  title="Visit the main page"></a></div>
				<!-- /logo -->
				
<!-- navigation -->
<div class="portal" role="navigation" id='p-navigation'>
	<h3>Navigation</h3>
	<div class="body">
		<ul>
			<li id="n-mainpage-description"><a href="Main_Page.html" title="Visit the main page [z]" accesskey="z">Main page</a></li>
			<li id="n-randompage"><a href="Spell_required.html" title="Load a random page [x]" accesskey="x">Random page</a></li>
		</ul>
	</div>
</div>

<!-- /navigation -->

<!-- HellGroundCore -->
<div class="portal" role="navigation" id='p-HellGroundCore'>
	<h3>HellGroundCore</h3>
	<div class="body">
		<ul>
			<li id="n-Project-site"><a href="https://hellground.net/" rel="nofollow">Project site</a></li>
			<li id="n-Project--forum"><a href="http://forum.hellground.net/" rel="nofollow">Project  forum</a></li>
			<li id="n-Project-repositories"><a href="http://emu.hellground.net/" rel="nofollow">Project repositories</a></li>
			<li id="n-Project-bug-tracker"><a href="http://forum.hellground.net/" rel="nofollow">Project bug tracker</a></li>
		</ul>
	</div>
</div>

<!-- /HellGroundCore -->

<!-- SEARCH -->

<!-- /SEARCH -->

<!-- TOOLBOX -->
<div class="portal" role="navigation" id='p-tb'>
	<h3>Tools</h3>
	<div class="body">
		<ul>
			<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/Tutorial_Fix_8076.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
			<li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/Tutorial_Fix_8076.html" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
			<li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
			<li id="t-print"><a href="http://wiki.hellground.net/index.php?title=Tutorial:Fix_8076&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
			<li id="t-permalink"><a href="http://wiki.hellground.net/index.php?title=Tutorial:Fix_8076&amp;oldid=1166" title="Permanent link to this revision of the page">Permanent link</a></li>
			<li id="t-info"><a href="http://wiki.hellground.net/index.php?title=Tutorial:Fix_8076&amp;action=info">Page information</a></li>
		</ul>
	</div>
</div>

<!-- /TOOLBOX -->

<!-- LANGUAGES -->

<!-- /LANGUAGES -->
			</div>
			<!-- /panel -->
		</div>
		<!-- footer -->
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 4 June 2014, at 14:49.</li>
											<li id="footer-info-viewcount">This page has been accessed 190 times.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="TBC_HellGroundCore_Privacy_policy.html" title="TBC HellGroundCore:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="TBC_HellGroundCore_About.html" title="TBC HellGroundCore:About">About HellGroundCore MMORPG framework educational and hobby project</a></li>
											<li id="footer-places-disclaimer"><a href="TBC_HellGroundCore_General_disclaimer.html" title="TBC HellGroundCore:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
					<li id="footer-poweredbyico">
						<a href="http://www.mediawiki.org/"><img src="../skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
					</li>
				</ul>
						<div style="clear:both"></div>
		</div>
		<!-- /footer -->
		<script>if(window.mw){
mw.loader.state({"site":"loading","user":"missing","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.view.postEdit","mediawiki.user","mediawiki.page.ready","mediawiki.searchSuggest","mediawiki.hidpi","skins.vector.js"], null, true);
}</script>
<script>if(window.mw){
mw.loader.state({"site":"ready"});
}</script>
<!-- Served in 0.074 secs. -->
	</body>

<!-- Mirrored from wiki.hellground.net/index.php/Tutorial:Fix_8076 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 12 Apr 2016 10:50:55 GMT -->
</html>
